name: Build and Release sbsh

on:
  push:
    branches:
      - main
  workflow_dispatch: {}

permissions:
  contents: write   # ðŸ‘ˆ å…³é”®

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    env:
      FILE_NAME: sbsh
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Prepare dist directory
        run: mkdir -p dist

      - name: Build sbsh for multiple architectures
        run: |
          ARCHS=("amd64" "arm64" "s390x")
          for arch in "${ARCHS[@]}"; do
            cp singbox-auto.sh "dist/sbsh-${arch}"
            chmod +x "dist/sbsh-${arch}"
          done

      - name: Upload sbsh to GitHub Release
        run: |
          ARCHS=("amd64" "arm64" "s390x")
          for arch in "${ARCHS[@]}"; do
            RELEASE_TAG="sbsh-${arch}-$(date +'%Y%m%d%H%M%S')"
            gh release create "$RELEASE_TAG" "dist/sbsh-${arch}" \
              --title "sbsh $arch" \
              --notes "Automatic release for $arch binary"
          done
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}